
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tishma - AI Legal Assistant</title>
  <!-- Google Fonts: Assistant -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@200..800&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#FFD700', // Vibrant Gold
            dark: '#000000',
            card: 'rgba(255, 255, 255, 0.05)',
            urgency: '#EF4444',
            slate: {
              400: '#94A3B8',
              500: '#64748B',
              800: '#1E293B',
              900: '#0F172A',
            }
          },
          fontFamily: {
            sans: ['Assistant', 'ui-sans-serif', 'system-ui'],
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            pulseSlow: {
              '0%, 100%': { opacity: '1' },
              '50%': { opacity: '0.5' },
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out forwards',
            'pulse-slow': 'pulseSlow 3s infinite',
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-color: #000000;
      color: #FFFFFF;
      font-family: 'Assistant', sans-serif;
      margin: 0;
      overflow-x: hidden;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .gold-glow {
      color: #FFD700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.4);
    }
    .diagonal-double-underline {
      position: relative;
      display: inline-block;
    }
    .diagonal-double-underline::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: -6px;
      width: 100%;
      height: 6px;
      background: repeating-linear-gradient(
        -45deg,
        transparent,
        transparent 3px,
        #FFD700 3px,
        #FFD700 6px
      );
      border-top: 2px solid #FFD700;
      border-bottom: 2px solid #FFD700;
      opacity: 0.9;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
      transform: skewX(-15deg);
    }
    *:focus-visible {
      outline: 2px solid #FFD700;
      outline-offset: 2px;
    }
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #000000;
    }
    ::-webkit-scrollbar-thumb {
      background: #333333;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #FFD700;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.38.0",
    "react": "https://esm.sh/react@^19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@^19.0.0/client",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body class="selection:bg-primary/30">
  <div id="root"></div>
  <script type="module">
    import { GoogleGenAI, Type } from "@google/genai";
    import React, { useState, useEffect, useRef } from "react";
    import ReactDOM from "react-dom/client";

    const e = React.createElement;

    // --- API KEY HANDLING ---
    // Using explicit check to prevent crash if env is undefined in raw HTML view
    const getApiKey = () => {
      try {
        return import.meta.env.VITE_GEMINI_API_KEY;
      } catch (err) {
        console.warn("API Key not found in import.meta.env");
        return "";
      }
    };
    
    const API_KEY = getApiKey();

    // --- TRANSLATIONS ---
    const translations = {
      he: {
        appName: "Tishma (×ª×©××¢)",
        slogan: "×”×•×¤×›×™× ×ª×¡×‘×•×›×ª ××©×¤×˜×™×ª",
        sloganAccent: "×œ×¤×¢×•×œ×” ×¤×©×•×˜×” ×œ×œ× ×¢×œ×•×ª.",
        legalFields: {
          labor: "×“×™× ×™ ×¢×‘×•×“×”",
          realestate: "××§×¨×§×¢×™×Ÿ",
          family: "××©×¤×—×”",
          tort: "× ×–×™×§×™×Ÿ",
          criminal: "×¤×œ×™×œ×™",
          other: "××—×¨"
        },
        chatPlaceholder: "×›×ª×•×‘ ×œ× ×™×¡×™× ×›××Ÿ...",
        thinking: "× ×™×¡×™× ×—×•×©×‘ ×¢×‘×•×¨×š...",
        listening: "××§×œ×™×˜...",
        upload: "×”×¢×œ××ª ×§×•×‘×¥",
        secure: "×××•×‘×˜×—"
      },
      en: {
        appName: "Tishma",
        slogan: "Turning legal complexity",
        sloganAccent: "into simple action, free of charge.",
        legalFields: {
          labor: "Labor Law",
          realestate: "Real Estate",
          family: "Family Law",
          tort: "Tort Law",
          criminal: "Criminal Law",
          other: "Other"
        },
        chatPlaceholder: "Ask Nissim...",
        thinking: "Nissim is thinking...",
        listening: "Listening...",
        upload: "Upload File",
        secure: "Secure"
      },
      ru: {
        appName: "Tishma",
        slogan: "ĞŸÑ€ĞµĞ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ ÑÑ€Ğ¸Ğ´Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸",
        sloganAccent: "Ğ² Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾.",
        legalFields: {
          labor: "Ğ¢Ñ€ÑƒĞ´Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¾",
          realestate: "ĞĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ",
          family: "Ğ¡ĞµĞ¼ĞµĞ¹Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¾",
          tort: "Ğ”ĞµĞ»Ğ¸ĞºÑ‚Ñ‹",
          criminal: "Ğ£Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¾",
          other: "Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ"
        },
        chatPlaceholder: "Ğ¡Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚Ğµ ĞĞ¸ÑÑĞ¸Ğ¼Ğ°...",
        thinking: "ĞĞ¸ÑÑĞ¸Ğ¼ Ğ´ÑƒĞ¼Ğ°ĞµÑ‚...",
        listening: "Ğ¡Ğ»ÑƒÑˆĞ°Ñ...",
        upload: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»",
        secure: "Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾"
      }
    };

    // --- ICONS ---
    const Icons = {
      Scale: () => e("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, 
        e("path", { d: "m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" }),
        e("path", { d: "m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" }),
        e("path", { d: "M7 21h10" }), e("path", { d: "M12 3v18" }), e("path", { d: "M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2" })
      ),
      CheckCircle: () => e("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        e("path", { d: "M22 11.08V12a10 10 0 1 1-5.93-9.14" }), e("polyline", { points: "22 4 12 14.01 9 11.01" })
      ),
      Upload: () => e("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        e("path", { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }), e("polyline", { points: "17 8 12 3 7 8" }), e("line", { x1: "12", y1: "3", x2: "12", y2: "15" })
      ),
      Mic: () => e("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        e("path", { d: "M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" }), e("path", { d: "M19 10v2a7 7 0 0 1-14 0v-2" }), e("line", { x1: "12", y1: "19", x2: "12", y2: "22" })
      ),
      Send: () => e("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        e("path", { d: "M22 2 11 13" }), e("path", { d: "m22 2-7 20-4-9-9-4Z" })
      ),
      Alert: () => e("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        e("circle", { cx: "12", cy: "12", r: "10" }), e("line", { x1: "12", y1: "8", x2: "12", y2: "12" }), e("line", { x1: "12", y1: "16", x2: "12.01", y2: "16" })
      ),
      Calendar: () => e("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" },
        e("rect", { x: "3", y: "4", width: "18", height: "18", rx: "2", ry: "2" }), e("line", { x1: "16", y1: "2", x2: "16", y2: "6" }), e("line", { x1: "8", y1: "2", x2: "8", y2: "6" }), e("line", { x1: "3", y1: "10", x2: "21", y2: "10" })
      )
    };

    // --- SERVICES ---
    const transcribeMicrophoneInput = async (audioBase64, lang) => {
      if (!API_KEY) throw new Error("API Key missing");
      const ai = new GoogleGenAI({ apiKey: API_KEY });
      const result = await ai.models.generateContent({
        model: 'gemini-3-flash-preview',
        contents: {
          parts: [
            { inlineData: { mimeType: 'audio/wav', data: audioBase64 } },
            { text: `Transcribe this precisely in ${lang} for a legal context. Output only the transcription text.` }
          ]
        }
      });
      return result.text;
    };

    const analyzeLegalDocument = async (fileName, fileData, targetLang) => {
      if (!API_KEY) throw new Error("API Key missing");
      const ai = new GoogleGenAI({ apiKey: API_KEY });
      const [mimePart, dataPart] = fileData.split(';base64,');
      
      const response = await ai.models.generateContent({
        model: 'gemini-3-pro-preview',
        contents: {
          parts: [
            { text: `Analyze this legal document (${fileName}) in ${targetLang}. Provide a summary.` },
            { inlineData: { mimeType: mimePart.replace('data:', ''), data: dataPart } }
          ]
        },
        config: {
            responseMimeType: "application/json",
            responseSchema: {
                type: Type.OBJECT,
                properties: {
                    content: { type: Type.STRING, description: "The summary content" },
                    suggestedReplies: { type: Type.ARRAY, items: { type: Type.STRING } }
                },
                required: ["content", "suggestedReplies"]
            }
        }
      });
      return JSON.parse(response.text || '{}');
    };

    // --- CHAT COMPONENT ---
    const ChatInterface = ({ lang, onClose }) => {
      const t = translations[lang];
      const [messages, setMessages] = useState([]);
      const [inputText, setInputText] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [isRecording, setIsRecording] = useState(false);
      const [userMessageCount, setUserMessageCount] = useState(0);
      const [sessionTerminated, setSessionTerminated] = useState(false);
      const scrollRef = useRef(null);
      const mediaRecorderRef = useRef(null);
      const chunksRef = useRef([]);

      const MESSAGE_LIMIT = 4;
      const isRtl = lang === 'he';

      useEffect(() => {
        if (messages.length === 0) {
          const intro = lang === 'he' 
            ? `×©×œ×•×, ×× ×™ × ×™×¡×™×, ×”××•××—×” ×‘×™× ×” ××©×¤×˜×™×ª ×”××™×©×™ ×©×œ×š :-) âœ¨\n\n×× ×™ ×›××Ÿ ×›×“×™ ×œ×”×¢× ×™×§ ×œ×š ×¢×–×¨×” ××©×¤×˜×™×ª ×¨××©×•× ×™×ª, ×œ×¤×©×˜ ×¢×‘×•×¨×š ××¡××›×™× ××•×¨×›×‘×™× ×•×œ×¢×–×•×¨ ×œ×š ×œ×”×‘×™×Ÿ ×‘×“×™×•×§ ××” ×”×¦×¢×“ ×”×‘× ×©×œ×š.\n\n××™×š ×× ×™ ×™×›×•×œ ×œ×¢×–×•×¨ ×œ×š ×”×™×•×? ğŸ˜Š\n\nâš ï¸ **×©×™××• ×œ×‘:** ×× ×™ ×¢×•×–×¨ ×‘×™× ×” ××œ××›×•×ª×™×ª ×•×œ× ×¢×•×¨×š ×“×™×Ÿ ×× ×•×©×™. ×›×“×™ ×œ×©××•×¨ ×¢×œ ×‘×™×˜×—×•×Ÿ ×”××™×“×¢, ×”×©×™×—×” ×ª××—×§ ×œ×¦××™×ª×•×ª ×œ××—×¨ 4 ×”×•×“×¢×•×ª.` 
            : `Hello, I'm Nissim, your personal Legal AI expert :-) âœ¨\n\nI'm here to provide initial legal help and simplify complex documents. How can I help you today? ğŸ˜Š\n\nâš ï¸ **Note:** I am an AI, not a lawyer. Conversations are deleted after 4 messages.`;

          setMessages([{
            role: 'model',
            content: intro,
            timestamp: new Date().toISOString(),
            quickReplies: [
              t.legalFields.labor,
              t.legalFields.realestate,
              t.legalFields.family,
              t.legalFields.tort
            ]
          }]);
        }
      }, [lang]);

      useEffect(() => {
        if (scrollRef.current) {
          scrollRef.current.scrollTo({ top: scrollRef.current.scrollHeight, behavior: 'smooth' });
        }
      }, [messages, isTyping]);

      const triggerLeadForm = () => setSessionTerminated(true);

      const handleLeadSubmit = (e) => {
        e.preventDefault();
        alert(lang === 'he' ? "×”×¤×¨×˜×™× ×”×ª×§×‘×œ×•! ×¢×•×¨×š ×“×™×Ÿ ××•××—×” ×™×—×–×•×¨ ××œ×™×š ×‘×§×¨×•×‘ ×××•×“. ğŸ˜Š" : "Details received! A specialist lawyer will contact you shortly. ğŸ˜Š");
        setMessages([]);
        setSessionTerminated(false);
        setUserMessageCount(0);
      };

      const sendMessage = async (text) => {
        if (!text.trim() || userMessageCount >= MESSAGE_LIMIT) return;

        const contactKeywords = ['×¢×•×¨×š ×“×™×Ÿ', '×¤×¨×˜×™×', '×œ×™×¦×•×¨ ×§×©×¨', '×˜×œ×¤×•×Ÿ', 'lawyer', 'details', 'contact', 'phone', '×™×™×¢×•×¥', '×¡×™×•×¢'];
        const contactTrigger = contactKeywords.some(kw => text.toLowerCase().includes(kw));
        
        if (contactTrigger && userMessageCount > 0) {
          triggerLeadForm();
          return;
        }

        const newCount = userMessageCount + 1;
        setUserMessageCount(newCount);
        
        setMessages(prev => [...prev, { role: 'user', content: text, timestamp: new Date().toISOString() }]);
        setInputText('');
        setIsTyping(true);

        try {
          if (!API_KEY) throw new Error("Missing API Key");
          const ai = new GoogleGenAI({ apiKey: API_KEY });
          const remaining = MESSAGE_LIMIT - newCount;
          
          const response = await ai.models.generateContent({
            model: 'gemini-3-pro-preview',
            contents: [
              { 
                role: 'user', 
                parts: [{ text: `Previous conversation summary: ${JSON.stringify(messages.slice(-3))}\n\nUser current message: ${text}` }] 
              }
            ],
            config: {
              systemInstruction: `You are Nissim (× ×™×¡×™×), Legal AI at Tishma.\nCRITICAL RULES:\n1. NO INTRODUCTIONS: Do not introduce yourself or say "Hello" again. Dive straight into the legal answer.\n2. TONE: Warm, professional, and helpful. Use emojis like âš–ï¸, âœ¨, ğŸ˜Š.\n3. REMINDER: You MUST append the following text to every response: "× ×©××¨×• ×œ× ×• ×¢×•×“ ${remaining} ×”×•×“×¢×•×ª ×œ×©×™×—×” ×–×• ğŸ˜Š" (translate to language if needed).\n4. QUICK REPLIES: Generate 3 short, interactive buttons that represent the best follow-up actions for the user.\n5. LANGUAGE: ${lang}.\n6. OUTPUT: Return strictly in JSON format.`,
              responseMimeType: "application/json",
              responseSchema: {
                type: Type.OBJECT,
                properties: {
                  content: { type: Type.STRING },
                  suggestedReplies: { type: Type.ARRAY, items: { type: Type.STRING } }
                },
                required: ["content", "suggestedReplies"]
              },
              tools: [{ googleSearch: {} }]
            }
          });

          const result = JSON.parse(response.text || '{}');
          
          setMessages(prev => [...prev, { 
            role: 'model', 
            content: result.content, 
            timestamp: new Date().toISOString(),
            quickReplies: [
              ...result.suggestedReplies,
              lang === 'he' ? "âš–ï¸ ×™×™×¢×•×¥ ××¢×•×¨×š ×“×™×Ÿ" : "âš–ï¸ Talk to a Lawyer"
            ]
          }]);

          if (newCount >= MESSAGE_LIMIT) {
            setTimeout(() => triggerLeadForm(), 5000);
          }
        } catch (error) {
          console.error(error);
          setMessages(prev => [...prev, { role: 'model', content: '××¦×˜×¢×¨, ×”×™×™×ª×” ×œ×™ ×©×’×™××” ×§×˜× ×” ×‘×—×™×‘×•×¨. × ×¡×” ×©×•×‘? ğŸ˜Š', timestamp: new Date().toISOString() }]);
        } finally {
          setIsTyping(false);
        }
      };

      const toggleRecording = async () => {
        if (userMessageCount >= MESSAGE_LIMIT) return;
        if (isRecording) {
          mediaRecorderRef.current?.stop();
          setIsRecording(false);
        } else {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const recorder = new MediaRecorder(stream);
            chunksRef.current = [];
            recorder.ondataavailable = (e) => chunksRef.current.push(e.data);
            recorder.onstop = async () => {
              const blob = new Blob(chunksRef.current, { type: 'audio/wav' });
              const reader = new FileReader();
              reader.onload = async () => {
                const base64 = reader.result.split(',')[1];
                setIsTyping(true);
                try {
                  const text = await transcribeMicrophoneInput(base64, lang);
                  if (text) setInputText(text);
                } catch (e) { console.error(e); }
                finally { setIsTyping(false); }
              };
              reader.readAsDataURL(blob);
            };
            recorder.start();
            mediaRecorderRef.current = recorder;
            setIsRecording(true);
          } catch (err) { alert("Microphone access denied."); }
        }
      };

      const handleFileUpload = async (e) => {
        if (userMessageCount >= MESSAGE_LIMIT) return;
        const file = e.target.files?.[0];
        if (!file) return;

        const newCount = userMessageCount + 1;
        setUserMessageCount(newCount);
        setMessages(prev => [...prev, { role: 'user', content: lang === 'he' ? `×¦×™×¨×¤×ª×™ ××¡××š: ${file.name}` : `Uploaded: ${file.name}`, timestamp: new Date().toISOString() }]);

        setIsTyping(true);
        const reader = new FileReader();
        reader.onload = async () => {
          try {
            const analysis = await analyzeLegalDocument(file.name, reader.result, lang);
            const remaining = MESSAGE_LIMIT - newCount;
            setMessages(prev => [...prev, {
              role: 'model',
              content: `${analysis.content}\n\n× ×©××¨×• ×œ× ×• ×¢×•×“ ${remaining} ×”×•×“×¢×•×ª ×œ×©×™×—×” ×–×• ğŸ˜Š\n\n×ª×¨×¦×” ×©××—×‘×¨ ××•×ª×š ×œ×¢×•×¨×š ×“×™×Ÿ ××•××—×” ×©×™×¢×‘×•×¨ ×¢×œ ×”××¡××š?`,
              timestamp: new Date().toISOString(),
              quickReplies: analysis.suggestedReplies || [
                lang === 'he' ? "×›×Ÿ, ××©××— ×œ×¢×•×¨×š ×“×™×Ÿ" : "Yes, get a lawyer",
                lang === 'he' ? "××” ×”×¡×™×›×•×™×™× ×©×œ×™?" : "What are my chances?"
              ]
            }]);
            if (newCount >= MESSAGE_LIMIT) setTimeout(() => triggerLeadForm(), 5000);
          } catch (error) {
            console.error(error);
            setMessages(prev => [...prev, { role: 'model', content: "×©×’×™××” ×‘× ×™×ª×•×— ×”××¡××š. × ×¡×” ×©×•×‘? ğŸ˜Š", timestamp: new Date().toISOString() }]);
          } finally { setIsTyping(false); }
        };
        reader.readAsDataURL(file);
      };

      if (sessionTerminated) {
        return e("div", { className: "flex flex-col w-full h-full bg-slate-950 text-white p-6 md:p-10 justify-center items-center text-center space-y-8 animate-in fade-in duration-700" },
          e("div", { className: "w-20 h-20 bg-primary rounded-3xl flex items-center justify-center text-black shadow-2xl" }, e(Icons.CheckCircle)),
          e("div", { className: "space-y-4 max-w-md" },
            e("h3", { className: "text-3xl font-black text-primary leading-tight" }, "×‘×™×˜×—×•×Ÿ ×”××™×“×¢ ×©×œ×š ×”×•× ××¢×œ ×”×›×œ âœ¨"),
            e("p", { className: "text-lg text-slate-300 font-medium" }, "×›×“×™ ×œ×”×’×Ÿ ×¢×œ ×¤×¨×˜×™×•×ª×š, ×”×©×™×—×” ×”×¡×ª×™×™××” ×•×›×œ ×ª×•×›× ×” × ××—×§ ×œ×¦××™×ª×•×ª."),
            e("div", { className: "p-6 bg-white/5 rounded-3xl border border-white/10" },
              e("p", { className: "text-md font-bold text-white" }, "×”×©××¨ ×¤×¨×˜×™× ×•× ×¦×™×’ ×× ×•×©×™ (×¢×•×¨×š ×“×™×Ÿ) ×™×—×–×•×¨ ××œ×™×š ×¢× ×”×™×™×¢×•×¥ ×”××œ×:")
            )
          ),
          e("form", { onSubmit: handleLeadSubmit, className: "w-full max-w-xs space-y-4" },
            e("input", { required: true, type: "text", placeholder: "×©× ××œ×", className: "w-full p-4 rounded-2xl bg-white/10 border-2 border-white/10 outline-none focus:border-primary text-lg" }),
            e("input", { required: true, type: "tel", placeholder: "××¡×¤×¨ ×˜×œ×¤×•×Ÿ", className: "w-full p-4 rounded-2xl bg-white/10 border-2 border-white/10 outline-none focus:border-primary text-lg" }),
            e("button", { type: "submit", className: "w-full py-5 bg-primary text-black rounded-3xl font-black text-xl shadow-xl hover:scale-105 active:scale-95 transition-all" }, "×©×œ×— ×•×§×‘×œ ×¡×™×•×¢ ×¢×›×©×™×•")
          )
        );
      }

      return e("div", { className: "flex flex-col w-full h-full bg-white relative" },
        // Chat Header
        e("div", { className: "bg-slate-50 border-b border-slate-100 px-6 py-4 flex justify-between items-center shrink-0 z-20" },
          e("div", { className: `flex items-center gap-3 ${!isRtl && 'flex-row-reverse'}` },
            e("div", { className: "w-10 h-10 bg-primary/20 rounded-xl flex items-center justify-center text-primary" }, e(Icons.Scale)),
            e("div", { className: "overflow-hidden" },
              e("h3", { className: "font-black text-slate-800 text-[16px] leading-tight truncate" }, "× ×™×¡×™× - ×¡×™×•×¢ ××©×¤×˜×™"),
              e("span", { className: "text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2" },
                e("div", { className: "w-2 h-2 rounded-full bg-green-500 animate-pulse" }),
                `${userMessageCount}/${MESSAGE_LIMIT} ${t.secure}`
              )
            )
          ),
          e("button", { onClick: onClose, className: "p-2 text-slate-300 hover:text-slate-600 transition-colors" },
            e("svg", { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "3", strokeLinecap: "round", strokeLinejoin: "round" },
              e("line", { x1: "18", y1: "6", x2: "6", y2: "18" }), e("line", { x1: "6", y1: "6", x2: "18", y2: "18" })
            )
          )
        ),
        // Messages Area
        e("div", { ref: scrollRef, className: "flex-grow overflow-y-auto p-4 md:p-8 space-y-8 bg-white/50 pb-32" },
          messages.map((msg, idx) => 
            e("div", { key: idx, className: `flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in duration-300` },
              e("div", { className: `max-w-[92%] p-5 md:p-8 rounded-[2.5rem] shadow-xl border-2 ${msg.role === 'user' ? 'bg-primary text-black font-bold border-primary rounded-tr-none' : 'bg-slate-50 text-slate-900 border-slate-100 rounded-tl-none'}` },
                e("div", { className: "text-[17px] md:text-[20px] leading-relaxed font-medium whitespace-pre-wrap" }, msg.content),
                msg.quickReplies && e("div", { className: `mt-6 flex flex-wrap gap-3 ${isRtl ? 'flex-row-reverse' : ''}` },
                  msg.quickReplies.map((qr, i) => 
                    e("button", { 
                      key: i, 
                      onClick: () => sendMessage(qr),
                      className: `px-6 py-3 rounded-2xl text-[14px] font-black border-2 transition-all active:scale-95 shadow-md flex-1 min-w-[120px] text-center ${qr.includes('×¢×•×¨×š ×“×™×Ÿ') || qr.includes('Lawyer') ? 'bg-primary border-primary text-black' : 'bg-white border-slate-200 text-slate-700 hover:border-primary'}` 
                    }, qr)
                  )
                )
              )
            )
          ),
          isTyping && e("div", { className: `flex ${isRtl ? 'justify-end' : 'justify-start'}` },
            e("div", { className: "bg-slate-50 border-2 border-slate-100 p-4 rounded-3xl flex gap-3 items-center shadow-sm" },
              e("span", { className: "text-[12px] font-black text-primary animate-pulse" }, t.thinking),
              e("div", { className: "w-1.5 h-1.5 bg-primary rounded-full animate-bounce" })
            )
          )
        ),
        // Input Area
        e("div", { className: "absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-white via-white to-transparent pt-10" },
          e("form", { onSubmit: (ev) => { ev.preventDefault(); sendMessage(inputText); }, className: `flex items-center gap-2 bg-slate-50 rounded-[2.5rem] border-2 border-slate-200 focus-within:border-primary focus-within:bg-white transition-all p-2 shadow-2xl ${!isRtl && 'flex-row-reverse'}` },
            e("div", { className: "flex gap-1" },
              e("label", { className: "w-12 h-12 rounded-full flex items-center justify-center text-slate-400 hover:text-primary cursor-pointer transition-all", title: t.upload },
                e("input", { type: "file", className: "hidden", accept: "image/*,application/pdf", onChange: handleFileUpload }),
                e(Icons.Upload)
              ),
              e("button", { type: "button", onClick: toggleRecording, className: `w-12 h-12 rounded-full flex items-center justify-center transition-all ${isRecording ? 'bg-red-500 text-white animate-pulse' : 'text-slate-400 hover:text-primary'}` },
                e(Icons.Mic)
              )
            ),
            e("input", {
              type: "text",
              value: inputText,
              onChange: (ev) => setInputText(ev.target.value),
              placeholder: t.chatPlaceholder,
              className: "flex-grow bg-transparent px-3 outline-none text-slate-900 text-lg font-medium h-12 placeholder-slate-300"
            }),
            e("button", { type: "submit", disabled: !inputText.trim() || isTyping, className: "w-12 h-12 bg-primary text-black rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-all disabled:opacity-30" },
              e("div", { className: !isRtl ? 'rotate-180' : '' }, e(Icons.Send))
            )
          )
        )
      );
    };

    // --- MAIN APP ---
    const App = () => {
      const [lang, setLang] = useState('he');
      const t = translations[lang];

      useEffect(() => {
        const dir = lang === 'he' ? 'rtl' : 'ltr';
        document.documentElement.dir = dir;
        document.documentElement.lang = lang;
        document.body.style.backgroundColor = '#000000';
      }, [lang]);

      const LanguageSwitcher = () => e("div", { className: "flex gap-2 bg-white/5 p-1 rounded-full border border-white/10 backdrop-blur-md" },
        ['he', 'en', 'ru'].map(l => 
          e("button", {
            key: l,
            onClick: () => setLang(l),
            className: `w-10 h-10 rounded-full text-[12px] font-black uppercase transition-all ${lang === l ? 'bg-primary text-black shadow-lg shadow-primary/40' : 'text-slate-400 hover:text-white'}`
          }, l)
        )
      );

      return e("div", { className: "min-h-screen flex flex-col bg-black text-white font-sans selection:bg-primary/30 overflow-x-hidden relative" },
        // Trust Background
        e("div", { className: "fixed inset-0 pointer-events-none opacity-[0.05] flex flex-wrap justify-around items-center p-20 gap-20 overflow-hidden grayscale" },
          Array.from({length: 12}).map((_, i) => 
            e("div", { key: i, className: "flex flex-col items-center gap-2" },
              e("div", { className: "text-primary" }, e(Icons.Scale)),
              e("span", { className: "text-[10px] font-black uppercase tracking-[0.4em] text-primary" }, `LAW OFFICE ${i+1}`)
            )
          )
        ),
        // Header
        e("header", { className: "sticky top-0 z-50 bg-black/80 backdrop-blur-xl border-b border-white/5 py-4 shrink-0" },
          e("div", { className: "max-w-7xl mx-auto px-6 flex justify-between items-center" },
            e("div", { className: "flex items-center gap-4" },
              e("div", { className: "bg-primary p-3 rounded-2xl text-black shadow-xl shadow-primary/30" }, e(Icons.Scale)),
              e("div", null,
                e("h1", { className: "text-2xl font-black tracking-tight uppercase leading-none" }, t.appName),
                e("p", { className: "text-[10px] font-black text-primary tracking-[0.3em] mt-1.5 uppercase opacity-90" }, "Legal AI Intelligence")
              )
            ),
            e("div", { className: "flex items-center gap-8" },
              e("nav", { className: "hidden lg:flex gap-8 text-[11px] font-black uppercase tracking-[0.2em] text-slate-500" },
                e("span", { className: "text-primary flex items-center gap-2" },
                  e("div", { className: "w-2.5 h-2.5 rounded-full bg-primary animate-pulse shadow-[0_0_15px_#FFD700]" }),
                  "×™×™×¢×•×¥ ×¨××©×•× ×™: × ×™×¡×™× ×–××™×Ÿ ×¢×›×©×™×•"
                )
              ),
              e(LanguageSwitcher)
            )
          )
        ),
        // Main Content
        e("main", { className: "flex-grow flex flex-col items-center justify-center py-10 relative z-10" },
          // Hero Text
          e("section", { className: "w-full max-w-5xl px-6 text-center space-y-8 mb-10 animate-in fade-in slide-in-from-top-4 duration-700" },
            e("div", { className: "inline-block px-5 py-2 rounded-full bg-primary/10 border border-primary/30 text-primary text-[11px] font-black tracking-[0.3em] uppercase" }, "×¡×™×•×¢ ××©×¤×˜×™ ××”×™×¨ ××‘×•×¡×¡ ×‘×™× ×” ××œ××›×•×ª×™×ª"),
            e("h2", { className: "text-4xl md:text-7xl font-black text-white leading-[1.1] tracking-tighter" },
              lang === 'he' 
                ? [
                    "×”×•×¤×›×™× ×ª×¡×‘×•×›×ª ××©×¤×˜×™×ª", 
                    e("br"), 
                    e("span", { className: "gold-glow" }, "×œ×¤×¢×•×œ×” ×¤×©×•×˜×”"), 
                    " ", 
                    e("span", { className: "diagonal-double-underline gold-glow" }, "×œ×œ× ×¢×œ×•×ª.")
                  ]
                : [t.slogan, e("br"), e("span", { className: "gold-glow" }, t.sloganAccent)]
            ),
            e("p", { className: "text-lg md:text-2xl text-slate-400 max-w-3xl mx-auto leading-relaxed font-light px-4" },
              "× ×™×¡×™× ×›××Ÿ ×›×“×™ ×œ×¤×©×˜ ×œ×š ××ª ×”×ª×”×œ×™×š ×•×œ×¢×–×•×¨ ×œ×š ×œ×”×‘×™×Ÿ ××ª ×–×›×•×™×•×ª×™×š ×ª×•×š ×“×§×•×ª.",
              e("br"),
              e("span", { className: "text-[10px] font-black uppercase text-primary/60 mt-6 block tracking-[0.4em]" }, "×¡×™×•×¢ ××©×¤×˜×™ ×¨××©×•× ×™ â€¢ ×œ×œ× ×¢×œ×•×ª â€¢ × ×™×ª×•×— ××¡××›×™× ×—×›×")
            )
          ),
          // Chat Container
          e("section", { className: "w-full flex justify-center px-4 animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-200" },
            e("div", { className: "bg-white rounded-[3rem] shadow-[0_50px_150px_rgba(0,0,0,0.8)] overflow-hidden transition-all duration-500 ease-in-out border-4 border-white/10 flex flex-col w-full max-w-[800px] min-h-[300px] max-h-[800px] group" },
              e(ChatInterface, { lang, onClose: () => {} })
            )
          ),
          // Badges
          e("div", { className: "mt-16 flex flex-wrap justify-center gap-16 opacity-40 grayscale hover:opacity-100 hover:grayscale-0 transition-all duration-700 cursor-default" },
            e("div", { className: "flex items-center gap-4 text-xs font-black uppercase tracking-widest text-primary" }, e(Icons.CheckCircle), " ×××•×‘×˜×— SSL 256-bit"),
            e("div", { className: "flex items-center gap-4 text-xs font-black uppercase tracking-widest text-primary" }, e(Icons.Alert), " ×”×’× ×ª ×¤×¨×˜×™×•×ª ××—××™×¨×”"),
            e("div", { className: "flex items-center gap-4 text-xs font-black uppercase tracking-widest text-primary" }, e(Icons.Calendar), " ×–××™× ×•×ª ××œ××” 24/7")
          )
        ),
        // Footer
        e("footer", { className: "bg-black border-t border-white/5 py-12 px-6 shrink-0 z-10" },
          e("div", { className: "max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8" },
            e("div", { className: "flex items-center gap-4" },
              e("div", { className: "text-primary w-10 h-10" }, e(Icons.Scale)),
              e("span", { className: "text-[12px] font-black uppercase tracking-[0.5em] text-slate-500" }, `Â© ${new Date().getFullYear()} Tishma Intelligence Systems`)
            ),
            e("div", { className: "flex gap-10 text-[11px] font-black uppercase tracking-widest text-slate-600" },
              e("a", { href: "#", className: "hover:text-primary transition-colors" }, "Legal Disclaimer"),
              e("a", { href: "#", className: "hover:text-primary transition-colors" }, "Privacy Policy"),
              e("a", { href: "#", className: "hover:text-primary transition-colors" }, "Contact Expert")
            )
          )
        )
      );
    };

    const rootElement = document.getElementById('root');
    if (!rootElement) throw new Error("Could not find root element to mount to");

    const root = ReactDOM.createRoot(rootElement);
    root.render(e(React.StrictMode, null, e(App)));
  </script>
</body>
</html>
